var K=Object.defineProperty,Q=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var tt=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable;var V=Math.pow,G=(e,o,i)=>o in e?K(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,F=(e,o)=>{for(var i in o||(o={}))tt.call(o,i)&&G(e,i,o[i]);if(P)for(var i of P(o))et.call(o,i)&&G(e,i,o[i]);return e},X=(e,o)=>Q(e,Z(o));import{r as _,o as u,c as p,a as t,b as h,w as d,F as x,d as s,e as Y,j as ot,f as T,t as f,g as N,h as st,i as nt,p as it,k as lt,n as A,l as $,m as C,q as E,s as g,v as y,u as j,x as at,y as rt,z as ht,A as dt,B as ct,C as ut}from"./vendor.fbe2c6ec.js";const pt=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function i(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerpolicy&&(l.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?l.credentials="include":n.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(n){if(n.ep)return;n.ep=!0;const l=i(n);fetch(n.href,l)}};pt();var ft="/assets/logo.d4e7ed01.svg",w=(e,o)=>{const i=e.__vccOpts||e;for(const[r,n]of o)i[r]=n;return i};const mt={computed:{}},_t={class:"flex flex-row justify-between my-10 items-center"},gt=t("img",{src:ft,class:"h-5 border-none rounded-none"},null,-1),bt={class:"flex flex-row gap-4"},yt=s("Home"),wt=s("Community"),vt={style:{"margin-bottom":"25%"}};function xt(e,o,i,r,n,l){const c=_("router-link"),a=_("l"),m=_("router-view");return u(),p(x,null,[t("nav",_t,[h(c,{to:"/",class:"hover:underline no-a"},{default:d(()=>[gt]),_:1}),t("div",bt,[h(a,{href:"https://frappebooks.com/",class:"no-a"},{default:d(()=>[yt]),_:1}),h(a,{href:"https://t.me/frappebooks",class:"no-a"},{default:d(()=>[wt]),_:1})])]),t("main",vt,[h(m)])],64)}var kt=w(mt,[["render",xt]]);Y.registerLanguage("javascript",ot);const $t={mounted(){Y.highlightElement(this.$refs.code)}},Tt={class:"w-full bg-slate-700 rounded-lg p-2 mb-5 border-2 border-slate-400"},Ct={ref:"code",class:"text-blue-100 bg-inherit font-light whitespace-pre-wrap"};function St(e,o,i,r,n,l){return u(),p("div",Tt,[t("code",Ct,[T(e.$slots,"default")],512)])}var It=w($t,[["render",St]]);const Bt={},Lt={class:"text-slate-500"};function Mt(e,o){return u(),p("em",Lt,[T(e.$slots,"default")])}var At=w(Bt,[["render",Mt]]);const Dt={},Vt={rel:"noreferrer nofollow noopener",target:"_blank"};function Nt(e,o){return u(),p("a",Vt,[T(e.$slots,"default")])}var jt=w(Dt,[["render",Nt]]);const Ot={methods:{toTheTop(){window.scrollTo(0,0)}}},Pt=t("hr",null,null,-1),Gt={class:"w-full flex justify-center"};function Ft(e,o,i,r,n,l){return u(),p(x,null,[Pt,t("footer",Gt,[t("button",{class:"bg-blue-50 text-blue-frappe btn",onClick:o[0]||(o[0]=(...c)=>l.toTheTop&&l.toTheTop(...c))}," to the top ")])],64)}var Xt=w(Ot,[["render",Ft]]);const Yt={"18alantom":"https://github.com/18alantom"};function H(e){return new Date(e).toDateString().split(" ").slice(1).join(" ")}function Et(e,o=140){const i=e.trim().slice(0,o);if(i.length<o)return i;const r=i.split(" ");return r.slice(0,r.length-1).join(" ")+"..."}const Ht={props:{date:String,author:String},computed:{postingDate(){return H(this.date)},href(){return Yt[this.author]}}},Rt={class:"mb-5"},Ut={class:"font-semibold text-4xl text-justify mb-5 text-slate-700"},Wt={class:"text-sm"},zt=t("span",null," \xB7 ",-1),qt={class:"font-light"};function Jt(e,o,i,r,n,l){const c=_("l");return u(),p("header",Rt,[t("h1",Ut,[T(e.$slots,"default")]),t("p",Wt,[h(c,{class:"font-semibold no-a hover:underline",href:l.href,rel:"noreferrer nofollow noopener",target:"_blank"},{default:d(()=>[s(f(i.author),1)]),_:1},8,["href"]),zt,t("span",qt,f(l.postingDate),1)])])}var Kt=w(Ht,[["render",Jt]]);const Qt={data(){return{path:"/complete_rewrite",title:"First Attempt at a Complete Rewrite",author:"18alantom",date:"2022-03-08",first:`
        Doing a complete rewrite of Frappe Books has been on my mind for around a month,
        so I thought I'd give it a shot. This post isn't about how I rewrote it from
        scratch \u2014 in Rust \u2014 and made it run faster than light. It's kinda the opposite.
      `}}},Zt=t("h2",null,"Why",-1),te=s(" A few months into working on Frappe Books, I started noticing a certain lack of cogency in the codebase, atleast to an extent that I'd prefer. There were bad patterns that gave me a strong sense of foreboding. "),ee=s("In the future, lots of users, lots of support..."),oe=t("p",null," Besides this, extending its feature set felt more arduous than it should be. And making it cross-platform would involve a large-scale refactor insofar as to warrant a complete rewrite anyway. ",-1),se=t("p",null,"Also it's just 30k lines of code, so might as well... \xAF\\_(\u30C4)_/\xAF",-1),ne=t("h2",null,"Starting the Rewrite",-1),ie=s(" Before going ahead, I asked a few devs their thoughts regarding this, they all basically told me that it's the worst idea ever. I was also sent a link to the "),le=s("Second-system effect"),ae=s(". "),re=s(" But I'm the kind of fool who would rather touch the pan to find out whether it is hot, than take someone's word for it. "),he=s('Else how will you know what "hot" even means?!'),de=N("<p> So, when the weekend arrived, I got to it. I already had the design in my head and across several <code>.md</code> files, so I got to coding the first iteration. </p><h2>And Then I Gave Up</h2><p> A few thousand lines and around 15 hours in, I deemed it not worth the effort. What I realised is: <code><i>re</i>writing != writing</code></p><p> When rewriting software you don&#39;t have the same kind of freedom as when writing it. A mental reference to the original has to be maintained. </p><p> Because of this, you have to take into account two models. The first one being the extant inferior one, and the second being the idealistic one that you haven&#39;t yet written. </p><p> The thing is if you don&#39;t have a close to perfect idea (the probability of which decreases with an increase in LoC) of the inferior codebase, chances are your idealistic version will end up with similar issues (but perhaps cleanly written). Edge cases aren&#39;t obvious and code written to account for them, even less so. </p><p> This is why incremental refactors maybe a better idea, the inferior copy is in constant reference. </p><p> You also have to attain feature parity and then some, i.e. there are targets and expectations. Dead hand of the software to be replaced. </p><p> The ideal behind a rewrite is that to take your software to some fictional idealistic point <b>C</b> from point <b>B</b>, where it currently is, would take longer than just rewriting it from point <b>A</b>. So if you don&#39;t go beyond point <b>B</b> in your rewrite, the whole exercise is moot. </p><h2>Secondhand Wisdom Aside; The Real Reason</h2><p> The above section is just some post-stupidity wisdom gained from having touched the pan. I was warned of all the pitfalls. So it&#39;s just me confirming that the pan was indeed, hot. </p><p> The real reason is, towards the end of my first 15 hour bout, my psyche started catching fire. I was experiencing some serious crisis. </p><p> The first version was written over 2 years by several devs. I&#39;d planned to attain feature parity in one month, which may have been doable, but I still needed to maintain and push the extant version (lest the project appear moribund for the second time in two years). </p><p>This meant that I was trying to hit a moving target with divided focus.</p><p> If I had to pull it off in a month, I&#39;d have to clock in at more than 16 hours per day, which means I&#39;d have to suspend all normal routines. I remember doing something of the sort once earlier, and at the end of that my mind had become churned ice cream and I had dropped 7 kilos of what felt like muscle mass. </p><p> Something of this sort can&#39;t be done with context switches, it requires constant lazer focus. </p><p> So given these circumstances, the ephemerality of my human self, and the finiteness of our universe \u2014 where even blackholes die \u2014 there was no way I could justify a ground-up rewrite, and so I let go... </p><hr><p> After having extrapolated my 15 hours and then freaking out, I&#39;ve since regained some equanimity and have concluded that I can still achieve whatever I&#39;ve set out to do with incremental refactors. </p><p> There&#39;s no need for a complete rewrite, so the title should&#39;ve been <i>First and Last Attempt at a Complete Rewrite</i>. </p>",20);function ce(e,o,i,r,n,l){const c=_("post-head"),a=_("di"),m=_("l");return u(),p(x,null,[h(c,{date:n.date,author:n.author},{default:d(()=>[s(f(n.title),1)]),_:1},8,["date","author"]),t("p",null,f(n.first),1),Zt,t("p",null,[te,h(a,null,{default:d(()=>[ee]),_:1})]),oe,se,ne,t("p",null,[ie,h(m,{href:"https://en.wikipedia.org/wiki/Second-system_effect"},{default:d(()=>[le]),_:1}),ae]),t("p",null,[re,h(a,null,{default:d(()=>[he]),_:1})]),de],64)}var ue=w(Qt,[["render",ce]]),pe="/assets/script.797b46f7.png";const fe={data(){return{path:"/enabling_translations",title:"Enabling Translations",author:"18alantom",date:"2022-02-17",first:`Not everyone knows English, and it is generally the least favorite
        language of polyglots (don't quote me on this). Suffice to say
        translations are important.`,regexExampleOne:"/(?<!w)t`([^`]+)`/g;",regexExampleTwo:"t`([^`]+)`",regexExampleThree:"(?<!w)"}},computed:{example(){return"// DON'T\n        t`Nested ${ t`Translations` }`;\n\n        // DO\n        const translations = t`Translations`;\n        t`Nested ${ translations }`;".split(`
`).map(e=>e.trim()).join(`
`)}}},me=t("p",null," Supporting translations in Frappe Books has always been at the back of my mind. Never at the front. Around three weeks back someone DMed me for language support. It shifted to the front. ",-1),_e=s(" I had no idea how to go about doing this, so I consulted "),ge=s("the developer who had asked me whether I had copied the code I had written"),be=s(" (from here on out, and in future posts, I'll refer to this developer as Dwight). "),ye=t("p",null," Dwight spoke in complications: dedicated translation portals, servers, APIs, JavaScript ASTs, etc. He also warned me that fetching the strings that have to be translated is like the hardest thing ever. ",-1),we=t("p",null," I don't know why he said that, he was probably thinking of writing an AST parser from scratch. Eventually, I felt complicators gonna complicate and decided to figure it out from scratch. ",-1),ve=t("h2",null,"Fetching the strings",-1),xe=s(" This was like the easiest thing. Strings that have to be translated in Frappe Books are "),ke=t("code",null,"t",-1),$e=s(f(" ")+" "),Te=s("tagged templates"),Ce=s(": "),Se=s("t`This string will be translated`;"),Ie=t("p",null,"As you can imagine, the regex to find these strings is equally simple:",-1),Be=s(" There are two parts to this pattern. The "),Le=s(" captures everything in the backticks. And the negative lookback "),Me=s(" ensures that it doesn't match non "),Ae=t("code",null,"t",-1),De=s(" tagged templates. "),Ve=s(" Because of the simplicity of this regex, I ditched my initial plans of using "),Ne=s("Semgrep"),je=s(" which would have been a bit of an overkill. "),Oe=t("p",null,[s(" Now I know that anyone can come up with valid strings that can circumvent this pattern. The thing is these edge cases won't occur. For instance: characters such as "),t("i",null,"\xE8"),s(" are not normalized into the grave accent and the "),t("i",null,"e"),s(", which means this \u{1F447} won't be "),t("code",null,"null"),s(": ")],-1),Pe=s("'\xE8'.match(/[^`]/);"),Ge=s(" And nested translations are a "),Fe=t("i",null,"Don't",-1),Xe=s(" (according to "),Ye=s("this"),Ee=s(" text): "),He=t("p",null," So by ignoring highly improbably edge cases, the core can be kept really simple. ",-1),Re=s("Note: if you do find some valid and probable string, please raise an "),Ue=s("issue"),We=s(", "),ze=s("DM"),qe=s(" me, or "),Je=s("tweet"),Ke=s(" at me."),Qe=t("h2",null,"The hard thing",-1),Ze=t("p",null," Frappe Books didn't always use tagged templates, it used to use this format: ",-1),to=s("_('Forsooth {0} {1}!', ['my', 'lord']);"),eo=s(" This \u{1F446} doesn't do much for readability and "),oo=t("code",null,"_",-1),so=s(" has "),no=s("connotations in JS"),io=s(". So I decided to change it to "),lo=t("code",null,"t",-1),ao=s(" tagged templates: "),ro=s("t`Forsooth ${ 'my' } ${ 'lord' }!`;"),ho=t("p",null,[s(" The beauty of this syntax is that, to mark a string as translateable, it's just one additional char: "),t("code",null,"t"),s(". ")],-1),co=s(" The hard part was migrating Vue 2 to Vue 3, this is what took like 90% of the time. "),uo=s(" I thought we were talking about translations, where did Vue migration come from?! "),po=s(" The thing is Frappe Books used to use Vue 2, and that did not have support for the tagged template syntax. "),fo=s(" Now if you're thinking "),mo=s("This guy's the dumbest developer ever, who gets sidetracked into framework migrations in the middle of a task? You could've just used a standard function!"),_o=s(" My response is, migrating Vue from 2 to 3 was another thing at the back of my mind, that too got bumped to the front. Also, I really like the tagged template syntax! "),go=N('<h2>The rest of the system</h2><p> The rest of it is pretty simple. A single script <code> generateTranslations.js</code> runs the regex pattern over all the code in the repository and either generates or regenerates the <code>language.csv</code>. </p><img src="'+pe+'"><figcaption>The script takes ~100ms to run.</figcaption><p> When required, the <code>language.csv</code> file is fetched from the repo, as opposed to packaging it into the binary. </p><p>This because:</p><ol><li> Receiving language updates should not be dependent on releases. If a language file update is merged, you&#39;ll be able to receive it immediately. </li><li class="line-through"> We live in a world where the people on HN bitch about electron app binary sizes. </li></ol><p> All in all, devving this wasn&#39;t really difficult, not counting the Vue migration, it took around 2 to 3 days. This can be attributed to not having written a JavaScript AST parser from scratch (which would&#39;ve been fun but way more work). </p><hr><p> I&#39;m not super happy with everything I&#39;ve done. For instance, I should&#39;ve probably used <code>json</code> instead of <code>csv</code>. This is something that will now remain at the back of my mind, at least until someone DMs me to do something about it. </p><p class="mb-1"><b>FAQ: I think I might be Dwight. Am I Dwight?</b></p><p> No, you&#39;re not. Dwight is an imaginary character in the Frappe Books extended universe. All resemblances to any real persons are purely coincidental, unintended, and probably hallucinatory. </p>',12);function bo(e,o,i,r,n,l){const c=_("post-head"),a=_("router-link"),m=_("l"),k=_("codeblock"),v=_("di");return u(),p(x,null,[h(c,{date:n.date,author:n.author},{default:d(()=>[s(f(n.title),1)]),_:1},8,["date","author"]),t("p",null,f(n.first),1),me,t("p",null,[_e,h(a,{to:"/why"},{default:d(()=>[ge]),_:1}),be]),ye,we,ve,t("p",null,[xe,ke,$e,h(m,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#tagged_templates"},{default:d(()=>[Te]),_:1}),Ce]),h(k,null,{default:d(()=>[Se]),_:1}),Ie,h(k,null,{default:d(()=>[s(f(n.regexExampleOne),1)]),_:1}),t("p",null,[Be,t("code",null,f(n.regexExampleTwo),1),Le,t("code",null,f(n.regexExampleThree),1),Me,Ae,De]),t("p",null,[Ve,h(m,{href:"https://github.com/returntocorp/semgrep"},{default:d(()=>[Ne]),_:1}),je]),Oe,h(k,null,{default:d(()=>[Pe]),_:1}),t("p",null,[Ge,Fe,Xe,h(m,{href:"https://github.com/frappe/books/wiki/Contributing-Translations#donts-of-using-t"},{default:d(()=>[Ye]),_:1}),Ee]),h(k,null,{default:d(()=>[s(f(l.example),1)]),_:1}),He,t("p",null,[t("i",null,[Re,h(m,{href:"https://github.com/frappe/books/issues/new"},{default:d(()=>[Ue]),_:1}),We,h(m,{href:"https://t.me/nalamot"},{default:d(()=>[ze]),_:1}),qe,h(m,{href:"https://twitter.com/18alantom"},{default:d(()=>[Je]),_:1}),Ke])]),Qe,Ze,h(k,null,{default:d(()=>[to]),_:1}),t("p",null,[eo,oo,so,h(m,{href:"https://stackoverflow.com/questions/32197927/standard-conventions-for-indicating-a-function-argument-is-unused-in-javascript"},{default:d(()=>[no]),_:1}),io,lo,ao]),h(k,null,{default:d(()=>[ro]),_:1}),ho,t("p",null,[co,h(v,null,{default:d(()=>[uo]),_:1}),po]),t("p",null,[fo,h(v,null,{default:d(()=>[mo]),_:1}),_o]),go],64)}var yo=w(fe,[["render",bo]]);const S=2100,L=S/3,wo={data(){return{clientX:S/2,clientY:L/2,width:S,height:L,vbX:S/2,vbY:L/2,useTransform:!1,cx:S/2,cy:L/2}},computed:{diskCross(){return`M 0 ${this.cy} H ${this.width} M ${this.cx} 0 V ${this.height}`}},methods:{reset(){this.cx=this.vbX=S/2,this.cy=this.vbY=L/2},onMouseMove({clientX:e,clientY:o}){this.clientX=e,this.clientY=o,this.setVbCoords(e,o),this.useTransform?(this.cx=this.vbX,this.cy=this.vbY):(this.cx=this.clientX,this.cy=this.clientY)},setVbCoords(e,o){const i=this.$refs.svgelem.getScreenCTM().inverse(),r=new DOMPoint(e,o),{x:n,y:l}=r.matrixTransform(i);this.vbX=parseInt(n),this.vbY=parseInt(l)}}},vo={class:"my-5 flex flex-col items-center"},xo={class:"border-2 rounded-lg my-2 w-full"},ko=["viewBox"],$o=["d"],To=["cx","cy"],Co=["x","y"],So=["x","y"],Io={class:"mb-0"},Bo=s(" Click on "),Lo={class:"mb-0"},Mo=t("code",null,"client",-1),Ao=s(" refers to cursor viewport coordinates i.e. "),Do=t("code",null,"clientX",-1),Vo=s(" and "),No=t("code",null,"clientY",-1),jo=s(" from "),Oo=s("MouseEvent"),Po=s(", and "),Go=t("code",null,"viewBox",-1),Fo=s(" refers to circle render coordinates in the SVG "),Xo=s("viewBox"),Yo=s(". "),Eo=s("Note: here the "),Ho=t("code",null,"viewBox",-1),Ro=t("code",null,"viewBox",-1),Uo=s(". You can try scrolling the page to bring it into view. ");function Wo(e,o,i,r,n,l){const c=_("l");return u(),p("div",vo,[t("div",xo,[(u(),p("svg",{viewBox:`0 0 ${n.width} ${n.height}`,onMousemove:o[0]||(o[0]=(...a)=>l.onMouseMove&&l.onMouseMove(...a)),onMouseleave:o[1]||(o[1]=(...a)=>l.reset&&l.reset(...a)),ref:"svgelem"},[t("path",{fill:"transparent",stroke:"#999","stroke-dasharray":"10, 10","stroke-width":"2",d:l.diskCross},null,8,$o),t("circle",{cx:n.cx,cy:n.cy,r:"20",fill:"#666"},null,8,To),t("text",{x:n.vbX+40,y:n.vbY-20,fill:"#666",class:"font-mono text-3xl"}," client: ("+f(n.clientX)+", "+f(n.clientY)+") ",9,Co),t("text",{x:n.cx+40,y:n.cy+40,fill:"#666",class:"font-mono text-3xl"}," viewBox: ("+f(n.cx)+", "+f(n.cy)+") ",9,So)],40,ko))]),t("button",{class:"btn-interactive",onClick:o[2]||(o[2]=a=>n.useTransform=!n.useTransform)},f(n.useTransform?"using transform":"not using transform"),1),t("figcaption",Io,[Bo,t("i",null,f(n.useTransform?"using transform":"not using transform"),1),s(" to toggle the use of transforms. "+f(n.useTransform?"The circle will render underneath the cursor because of the transform.":"The circle will not be aligned with the cursor because it's using viewport coordinates."),1)]),t("figcaption",Lo,[Mo,Ao,Do,Vo,No,jo,h(c,{href:"https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent"},{default:d(()=>[Oo]),_:1}),Po,Go,Fo,h(c,{href:"https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/viewBox"},{default:d(()=>[Xo]),_:1}),Yo]),t("figcaption",null,[t("i",null,[Eo,Ho,s(" has a width of "+f(n.width)+" and a height of "+f(n.height)+", so depending on the scroll location, the circle may render outside the ",1),Ro,Uo])])])}var zo=w(wo,[["render",Wo]]);function R(e=0,o=0){return()=>({width:0,height:0,top:o,right:e,bottom:o,left:e})}const qo={props:{offset:{type:Number,default:10},placement:{type:String,default:"auto"}},data(){return{popper:null,virtualElement:null,opacity:0}},methods:{create(){if(this.popper){this.opacity=1;return}this.$refs.tooltip.setAttribute("data-show",""),this.virtualElement={getBoundingClientRect:R(-1e3,-1e3)},this.popper=st(this.virtualElement,this.$refs.tooltip,{placement:this.placement,modifiers:[nt,it,Object.assign(lt,{options:{offset:[0,this.offset]}})]}),this.opacity=1},update({clientX:e,clientY:o}){!this.popper||!this.virtualElement||(this.virtualElement.getBoundingClientRect=R(e,o),this.popper.update())},destroy(){var e;this.opacity=0,this.$refs.tooltip.removeAttribute("data-show"),(e=this.popper)==null||e.destroy(),this.virtualElement=null,this.popper=null}}};function Jo(e,o,i,r,n,l){return u(),p("div",{id:"tooltip",ref:"tooltip",style:A([{transition:"opacity 100ms ease-in"},{opacity:n.opacity}])},[T(e.$slots,"default",{},void 0,!0)],4)}var Ko=w(qo,[["render",Jo],["__scopeId","data-v-58682ae4"]]);function Qo(e){if(Math.abs(e)<1)return Math.round(e).toString();const o=Math.floor(Math.log10(Math.abs(e))),i=Math.floor(o/3),r=Math.round(e/Math.pow(10,i*3)),n=["","K","M","B","T","Q","P"][i];return`${r} ${n}`}function Zo(e,o,i,r){const n=Math.pow(i-e,2)+Math.pow(r-o,2);return Math.sqrt(n)}const ts={props:{colors:{type:Array,default:()=>[]},xLabels:{type:Array,default:()=>[]},yLabelDivisions:{type:Number,default:4},points:{type:Array,default:()=>[[]]},drawAxis:{type:Boolean,default:!1},drawXGrid:{type:Boolean,default:!0},viewBoxHeight:{type:Number,default:500},aspectRatio:{type:Number,default:4},axisPadding:{type:Number,default:30},pointsPadding:{type:Number,default:24},xLabelOffset:{type:Number,default:20},yLabelOffset:{type:Number,default:5},gridColor:{type:String,default:"rgba(0, 0, 0, 0.2)"},axisColor:{type:String,default:"rgba(0, 0, 0, 0.5)"},thickness:{type:Number,default:5},axisThickness:{type:Number,default:1},gridThickness:{type:Number,default:.5},yMin:{type:Number,default:null},yMax:{type:Number,default:null},format:{type:Function,default:e=>e.toFixed(1)},formatY:{type:Function,default:Qo},formatX:{type:Function,default:e=>e},fontSize:{type:Number,default:18},fontColor:{type:String,default:"#415668"},bottom:{type:Number,default:0},left:{type:Number,default:55},extendGridX:{type:Number,default:-20},tooltipDispDistThreshold:{type:Number,default:20},showTooltip:{type:Boolean,default:!0},useGradients:{type:Boolean,default:!0}},computed:{fontStyle(){return{fontSize:this.fontSize,fill:this.fontColor}},viewBoxWidth(){return this.aspectRatio*this.viewBoxHeight},num(){return this.points.length},count(){return Math.max(...this.points.map(e=>e.length))},xs(){return Array(this.count).fill().map((e,o)=>this.padding+this.left+o*(this.viewBoxWidth-this.left-2*this.padding)/(this.count-1))},ys(){var i,r;let e=(i=this.yMin)!=null?i:this.min,o=(r=this.yMax)!=null?r:this.max;return e===o&&(e=e-20,o=o+20),this.points.map(n=>n.map(l=>this.padding+(1-(l-e)/(o-e))*(this.viewBoxHeight-2*this.padding-this.bottom)))},xy(){return this.xs.map((e,o)=>[e,this.ys.map(i=>i[o])])},min(){return Math.min(...this.points.flat())},max(){return Math.max(...this.points.flat())},axis(){return`M ${this.axisPadding+this.left} ${this.axisPadding} V ${this.viewBoxHeight-this.axisPadding-this.bottom} H ${this.viewBoxWidth-this.axisPadding}`},padding(){return this.axisPadding+this.pointsPadding},xGrid(){const{l:e,r:o}=this.xLims,i=e-this.extendGridX,r=o+this.extendGridX;return Array(this.yLabelDivisions+1).fill().map((l,c)=>this.yScalerLocation(c)).map(l=>`M ${i} ${l} H ${r}`).join(" ")},yGrid(){return[]},xLims(){const e=this.padding+this.left,o=this.viewBoxWidth-this.padding;return{l:e,r:o}}},data(){return{cx:-1,cy:-1,xi:-1,yi:-1}},methods:{gradY(e){return Math.min(...this.ys[e]).toFixed()},yScalerLocation(e){return(this.yLabelDivisions-e)*(this.viewBoxHeight-this.padding*2-this.bottom)/this.yLabelDivisions+this.padding},yScalerValue(e){var r,n;let o=(r=this.yMin)!=null?r:this.min,i=(n=this.yMax)!=null?n:this.max;return o===i&&(o=o-20,i=i+20),this.formatY(e*(i-o)/this.yLabelDivisions+o)},getLine(e){const[o,i]=this.xy[0];let r=`M ${o} ${i[e]} `;return this.xy.slice(1).forEach(([n,l])=>{r+=`L ${n} ${l[e]} `}),r},getGradLine(e){let o=this.viewBoxHeight-this.padding-this.bottom,i=`M ${this.padding+this.left} ${o}`;return this.xy.forEach(([r,n])=>{i+=`L ${r} ${n[e]} `}),i+` V ${o} Z`},getRandomColor(){return`rgb(${Array(3).fill().map(()=>parseInt(Math.random()*255)).join(",")})`},update(e){if(!this.showTooltip)return;const{x:o,y:i}=this.getSvgXY(e),{xi:r,yi:n,cx:l,cy:c,d:a}=this.getPointIndexAndCoords(o,i);if(a>this.tooltipDispDistThreshold){this.xi=-1,this.yi=-1,this.cx=-1,this.cy=-1,this.$refs.tooltip.destroy();return}this.$refs.tooltip.create(),this.xi=r,this.yi=n,this.cx=l,this.cy=c,this.$refs.tooltip.update(e)},getSvgXY({clientX:e,clientY:o}){const i=this.$refs.chartSvg.getScreenCTM().inverse(),r=new DOMPoint(e,o),{x:n,y:l}=r.matrixTransform(i);return{x:n,y:l}},getPointIndexAndCoords(e,o){const{l:i,r}=this.xLims,n=Math.round((e-i)/((r-i)/(this.count-1)));if(n<0||n>this.count-1)return{d:this.tooltipDispDistThreshold+1};const l=this.xs[n],c=this.ys.map(v=>v[n]),a=c.map(v=>Zo(e,o,l,v)),m=Math.min(...a),k=a.map((v,B)=>[v-m,B]).filter(([v,B])=>v===0).at(-1)[1];return{xi:n,yi:k,cx:l,cy:c[k],d:m}}},components:{Tooltip:Ko}},es=["viewBox"],os=["d","stroke","stroke-width"],ss=["d","stroke-width","stroke"],ns=["y","x"],is=["y","x"],ls=t("linearGradient",{id:"grad",x1:"0",y1:"0",x2:"0",y2:"85%"},[t("stop",{offset:"0%","stop-color":"rgba(255, 255, 255, 0.5)"}),t("stop",{offset:"40%","stop-color":"rgba(255, 255, 255, 0.1)"}),t("stop",{offset:"70%","stop-color":"rgba(255, 255, 255, 0)"})],-1),as=["id"],rs=["y","height"],hs=["d","stroke-width","fill","mask"],ds=["d","stroke","stroke-width"],cs=["cx","cy","fill"],us={class:"font-semibold"};function ps(e,o,i,r,n,l){const c=_("Tooltip");return u(),p("div",null,[(u(),p("svg",{ref:"chartSvg",viewBox:`0 0 ${l.viewBoxWidth} ${i.viewBoxHeight}`,xmlns:"http://www.w3.org/2000/svg",onMousemove:o[0]||(o[0]=(...a)=>l.update&&l.update(...a))},[i.drawXGrid?(u(),p("path",{key:0,d:l.xGrid,stroke:i.gridColor,"stroke-width":i.gridThickness,"stroke-linecap":"round",fill:"transparent"},null,8,os)):$("",!0),i.drawAxis?(u(),p("path",{key:1,d:l.axis,"stroke-width":i.axisThickness,stroke:i.axisColor,fill:"transparent"},null,8,ss)):$("",!0),i.xLabels.length>0&&l.count>1?(u(!0),p(x,{key:2},C(l.count,(a,m)=>(u(),p("text",{style:A(l.fontStyle),key:m+"-xlabels",y:i.viewBoxHeight-i.axisPadding+i.yLabelOffset+l.fontStyle.fontSize/2-i.bottom,x:l.xs[a-1],"text-anchor":"middle"},f(i.formatX(i.xLabels[a-1]||"")),13,ns))),128)):$("",!0),i.yLabelDivisions>0?(u(!0),p(x,{key:3},C(i.yLabelDivisions+1,(a,m)=>(u(),p("text",{style:A(l.fontStyle),key:m+"-ylabels",y:l.yScalerLocation(a-1),x:i.axisPadding-i.xLabelOffset+i.left,"text-anchor":"end"},f(l.yScalerValue(a-1)),13,is))),128)):$("",!0),t("defs",null,[ls,(u(!0),p(x,null,C(l.num,(a,m)=>(u(),p("mask",{key:m+"-mask",id:"rect-mask-"+a},[t("rect",{x:"0",y:l.gradY(m),height:i.viewBoxHeight-l.gradY(m),width:"100%",fill:"url('#grad')"},null,8,rs)],8,as))),128))]),(u(!0),p(x,null,C(l.num,(a,m)=>(u(),p("g",{key:m+"-gpath"},[i.useGradients?(u(),p("path",{key:0,"stroke-linejoin":"round",d:l.getGradLine(a-1),"stroke-width":i.thickness,"stroke-linecap":"round",fill:i.colors[a-1]||l.getRandomColor(),mask:`url('#rect-mask-${a}')`},null,8,hs)):$("",!0),t("path",{"stroke-linejoin":"round",d:l.getLine(a-1),stroke:i.colors[a-1]||l.getRandomColor(),"stroke-width":i.thickness,"stroke-linecap":"round",fill:"transparent"},null,8,ds)]))),128)),n.xi>-1&&n.yi>-1?(u(),p("circle",{key:4,r:"12",cx:n.cx,cy:n.cy,fill:i.colors[n.yi],style:{filter:"brightness(115%) drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.25))"}},null,8,cs)):$("",!0)],40,es)),i.showTooltip?(u(),E(c,{key:0,ref:"tooltip",offset:15,placement:"top",class:"text-sm shadow-md px-2 py-1 bg-white text-gray-900 border-l-2",style:A({borderColor:i.colors[n.yi]})},{default:d(()=>[t("div",null,[t("p",null,[s(f(n.xi>-1?i.xLabels[n.xi]:"")+" ",1),t("span",us,f(n.yi>-1?i.format(i.points[n.yi][n.xi]):""),1)])])]),_:1},8,["style"])):$("",!0)])}var fs=w(ts,[["render",ps]]);const O={pointsString:"10, 80, -10, 50, 0; 10, 20, 100, -10, 30",points:[[10,80,-10,50,0],[10,20,100,-10,30]],xLabelsString:"A, B, C, D, E",gridColor:"#CCCCCC",axisColor:"#CCCCCC",lineColorsString:"#B7BFC6, #0089FF",lineThickness:5,fontColor:"#415668",fontSize:24,xLabelOffset:25,yLabelOffset:20,axisPadding:30,pointsPadding:20,axisThickness:1,gridThickness:.5,bottom:25,left:45,yLabelDivisions:4,extendGridX:0,drawAxis:!0,drawXGrid:!0,useGradients:!0,viewBoxHeight:600},ms={props:{axisOn:{type:Boolean,default:!0},showTooltip:{type:Boolean,default:!1},showControls:{type:Boolean,default:!0}},data(){return X(F({},O),{tooltipDispDistThreshold:20,aspectRatio:3,isShowing:!1})},computed:{xLabels(){return this.xLabelsString.split(",").map(e=>e.trim()).filter(e=>e.length)},lineColors(){return this.lineColorsString.split(",").map(e=>e.trim()).filter(e=>e.length)},points(){return this.pointsString.split(";").map(e=>e.split(",").map(o=>parseFloat(o.trim())).filter(o=>!Number.isNaN(o)))},buttonText(){return this.isShowing?"hide controls":"show controls"}},methods:{reset(){Object.keys(O).forEach(e=>{this[e]=O[e]})},toggleIsShowing(){this.isShowing=!this.isShowing,this.$emit("showing-toggle",this.buttonText)}},components:{LineChart:fs}},b=e=>(at("data-v-cf280dd4"),e=e(),rt(),e),_s={class:"mb-5"},gs={class:"border-2 rounded-lg my-2"},bs={key:0,class:"flex flex-col rounded-lg text-slate-600 p-2 text-sm bg-slate-100"},ys={class:"flex flex-row justify-between w-full"},ws={key:0,class:"grid grid-cols-2 md:grid-cols-4 w-full p-2 gap-y-4 gap-x-8 mt-2 border-t-2"},vs={class:"control"},xs=b(()=>t("p",{class:"lbl"},"points",-1)),ks={class:"control"},$s=b(()=>t("p",{class:"lbl"},"xLabels",-1)),Ts={class:"control"},Cs=b(()=>t("p",{class:"lbl"},"lineColors",-1)),Ss={class:"control"},Is=b(()=>t("p",{class:"lbl"},"lineThickness",-1)),Bs={class:"control"},Ls=b(()=>t("p",{class:"lbl"},"fontColor",-1)),Ms={class:"control"},As=b(()=>t("p",{class:"lbl"},"fontSize",-1)),Ds={class:"control"},Vs=b(()=>t("p",{class:"lbl"},"yLabelOffset",-1)),Ns={class:"control"},js=b(()=>t("p",{class:"lbl"},"xLabelOffset",-1)),Os={class:"control"},Ps=b(()=>t("p",{class:"lbl"},"axisPadding",-1)),Gs={class:"control"},Fs=b(()=>t("p",{class:"lbl"},"pointsPadding",-1)),Xs={class:"control"},Ys=b(()=>t("p",{class:"lbl"},"axisThickness",-1)),Es={class:"control"},Hs=b(()=>t("p",{class:"lbl"},"axisColor",-1)),Rs={class:"control"},Us=b(()=>t("p",{class:"lbl"},"gridThickness",-1)),Ws={class:"control"},zs=b(()=>t("p",{class:"lbl"},"gridColor",-1)),qs={class:"control"},Js=b(()=>t("p",{class:"lbl"},"bottomOffset",-1)),Ks={class:"control"},Qs=b(()=>t("p",{class:"lbl"},"leftOffset",-1)),Zs={class:"control"},tn=b(()=>t("p",{class:"lbl"},"yLabelDivisions",-1)),en={class:"control"},on=b(()=>t("p",{class:"lbl"},"extendGridX",-1)),sn={class:"control"},nn=b(()=>t("p",{class:"lbl"},"viewBoxHeight",-1)),ln={class:"control"},an=b(()=>t("p",{class:"lbl"},"drawAxis",-1)),rn={class:"control"},hn=b(()=>t("p",{class:"lbl"},"drawXGrid",-1)),dn={class:"control"},cn=b(()=>t("p",{class:"lbl"},"useGradients",-1));function un(e,o,i,r,n,l){const c=_("LineChart");return u(),p("div",_s,[t("div",gs,[h(c,{colors:l.lineColors,xLabels:l.xLabels,yLabelDivisions:e.yLabelDivisions,points:l.points,drawAxis:i.axisOn&&e.drawAxis,drawXGrid:e.drawXGrid,viewBoxHeight:e.viewBoxHeight,aspectRatio:n.aspectRatio,axisPadding:e.axisPadding,pointsPadding:e.pointsPadding,xLabelOffset:e.yLabelOffset,yLabelOffset:i.axisOn?e.xLabelOffset:e.xLabelOffset-10,gridColor:e.gridColor,axisColor:e.axisColor,thickness:e.lineThickness,axisThickness:e.axisThickness,gridThickness:e.gridThickness,fontSize:e.fontSize,fontColor:e.fontColor,bottom:e.bottom,left:e.left,extendGridX:e.extendGridX,tooltipDispDistThreshold:n.tooltipDispDistThreshold,showTooltip:i.showTooltip,useGradients:e.useGradients},null,8,["colors","xLabels","yLabelDivisions","points","drawAxis","drawXGrid","viewBoxHeight","aspectRatio","axisPadding","pointsPadding","xLabelOffset","yLabelOffset","gridColor","axisColor","thickness","axisThickness","gridThickness","fontSize","fontColor","bottom","left","extendGridX","tooltipDispDistThreshold","showTooltip","useGradients"])]),i.showControls?(u(),p("div",bs,[t("div",ys,[t("button",{class:"btn",onClick:o[0]||(o[0]=(...a)=>l.toggleIsShowing&&l.toggleIsShowing(...a))},f(l.buttonText),1),t("button",{class:"btn",onClick:o[1]||(o[1]=(...a)=>l.reset&&l.reset(...a))},"reset")]),n.isShowing?(u(),p("div",ws,[t("div",vs,[xs,g(t("input",{class:"inp",type:"text","onUpdate:modelValue":o[2]||(o[2]=a=>e.pointsString=a)},null,512),[[y,e.pointsString]])]),t("div",ks,[$s,g(t("input",{class:"inp",type:"text","onUpdate:modelValue":o[3]||(o[3]=a=>e.xLabelsString=a)},null,512),[[y,e.xLabelsString]])]),t("div",Ts,[Cs,g(t("input",{class:"inp",type:"text","onUpdate:modelValue":o[4]||(o[4]=a=>e.lineColorsString=a)},null,512),[[y,e.lineColorsString]])]),t("div",Ss,[Is,g(t("input",{class:"inp",type:"number","onUpdate:modelValue":o[5]||(o[5]=a=>e.lineThickness=a),min:"0",max:"100",step:"0.1"},null,512),[[y,e.lineThickness]])]),t("div",Bs,[Ls,g(t("input",{class:"inp-color",type:"color","onUpdate:modelValue":o[6]||(o[6]=a=>e.fontColor=a)},null,512),[[y,e.fontColor]])]),t("div",Ms,[As,g(t("input",{class:"inp",type:"number","onUpdate:modelValue":o[7]||(o[7]=a=>e.fontSize=a),min:"0",max:"100",step:"0.1"},null,512),[[y,e.fontSize]])]),t("div",Ds,[Vs,g(t("input",{class:"inp",type:"number","onUpdate:modelValue":o[8]||(o[8]=a=>e.yLabelOffset=a),min:"-100",max:"100",step:"0.1"},null,512),[[y,e.yLabelOffset]])]),t("div",Ns,[js,g(t("input",{class:"inp",type:"number","onUpdate:modelValue":o[9]||(o[9]=a=>e.xLabelOffset=a),min:"-100",max:"100",step:"0.1"},null,512),[[y,e.xLabelOffset]])]),t("div",Os,[Ps,g(t("input",{class:"inp",type:"number","onUpdate:modelValue":o[10]||(o[10]=a=>e.axisPadding=a),min:"-100",max:"100",step:"0.1"},null,512),[[y,e.axisPadding]])]),t("div",Gs,[Fs,g(t("input",{class:"inp",type:"number","onUpdate:modelValue":o[11]||(o[11]=a=>e.pointsPadding=a),min:"-100",max:"100",step:"0.1"},null,512),[[y,e.pointsPadding]])]),t("div",Xs,[Ys,g(t("input",{class:"inp",type:"number","onUpdate:modelValue":o[12]||(o[12]=a=>e.axisThickness=a),min:"0",max:"100",step:"0.1"},null,512),[[y,e.axisThickness]])]),t("div",Es,[Hs,g(t("input",{class:"inp-color",type:"color","onUpdate:modelValue":o[13]||(o[13]=a=>e.axisColor=a)},null,512),[[y,e.axisColor]])]),t("div",Rs,[Us,g(t("input",{class:"inp",type:"number","onUpdate:modelValue":o[14]||(o[14]=a=>e.gridThickness=a),min:"0",max:"100",step:"0.1"},null,512),[[y,e.gridThickness]])]),t("div",Ws,[zs,g(t("input",{class:"inp-color",type:"color","onUpdate:modelValue":o[15]||(o[15]=a=>e.gridColor=a)},null,512),[[y,e.gridColor]])]),t("div",qs,[Js,g(t("input",{class:"inp",type:"number","onUpdate:modelValue":o[16]||(o[16]=a=>e.bottom=a),min:"-100",max:"100",step:"0.1"},null,512),[[y,e.bottom]])]),t("div",Ks,[Qs,g(t("input",{class:"inp",type:"number","onUpdate:modelValue":o[17]||(o[17]=a=>e.left=a),min:"-100",max:"100",step:"0.1"},null,512),[[y,e.left]])]),t("div",Zs,[tn,g(t("input",{class:"inp",type:"number","onUpdate:modelValue":o[18]||(o[18]=a=>e.yLabelDivisions=a),min:"0",max:"100",step:"1"},null,512),[[y,e.yLabelDivisions]])]),t("div",en,[on,g(t("input",{class:"inp",type:"number","onUpdate:modelValue":o[19]||(o[19]=a=>e.extendGridX=a),min:"-100",max:"100",step:"1"},null,512),[[y,e.extendGridX]])]),t("div",sn,[nn,g(t("input",{class:"inp",type:"number","onUpdate:modelValue":o[20]||(o[20]=a=>e.viewBoxHeight=a),min:"0",max:"10000",step:"10"},null,512),[[y,e.viewBoxHeight]])]),t("div",ln,[an,g(t("input",{class:"inp-check",type:"checkbox","onUpdate:modelValue":o[21]||(o[21]=a=>e.drawAxis=a)},null,512),[[j,e.drawAxis]])]),t("div",rn,[hn,g(t("input",{class:"inp-check",type:"checkbox","onUpdate:modelValue":o[22]||(o[22]=a=>e.drawXGrid=a)},null,512),[[j,e.drawXGrid]])]),t("div",dn,[cn,g(t("input",{class:"inp-check",type:"checkbox","onUpdate:modelValue":o[23]||(o[23]=a=>e.useGradients=a)},null,512),[[j,e.useGradients]])])])):$("",!0)])):$("",!0),t("figcaption",null,[T(e.$slots,"default",{},void 0,!0)])])}var pn=w(ms,[["render",un],["__scopeId","data-v-cf280dd4"]]);const fn={data(){return{width:600,height:200,padding:10,pointString:"10, 20, 100, -10, 30",isActive:!1}},computed:{count(){return this.data.length},data(){return this.pointString.split(",").map(e=>parseFloat(e.trim())).filter(e=>!Number.isNaN(e))},xs(){const e=(this.width-2*this.padding)/(this.count-1||1);return Array(this.count).fill().map((o,i)=>i*e+this.padding)},ys(){let e=Math.min(...this.data),o=Math.max(...this.data);e===o&&(e=e-e/2,o=o+o/2);const i=this.height-2*this.padding;return this.data.map(r=>{const n=(r-e)/(o-e);return i-n*i+this.padding})},path(){if(this.count===0)return"M 0.0 0.0";let e=`M ${this.xs[0].toFixed(1)} ${this.ys[0].toFixed(1)}`;if(this.count===1)return e;const o=this.ys.slice(1);return this.xs.slice(1).map((r,n)=>{e+=` L ${r.toFixed(1)} ${o[n].toFixed(1)}`}),e}},methods:{reset(){this.pointString="10, 20, 100, -10, 30"}}},mn={class:"my-5"},_n={class:"border-2 rounded-lg my-2"},gn=["viewBox"],bn=["d"],yn={class:"w-full bg-white rounded-b-lg p-2 mb-0 text-gray-600 text-sm border-t-2"},wn=t("figcaption",{class:"mb-0"},[s(" Try changing the data points to see the generated line and "),t("code",null,"d"),s(" attribute of the "),t("code",null,"<path/>"),s(" element that positions the line. ")],-1),vn=t("figcaption",null,[t("i",null,[s(" Note: The points are min-max scaled to "),t("code",null,"viewBox"),s(" coordinates. So they'll never render outside the container. ")])],-1);function xn(e,o,i,r,n,l){return u(),p("div",mn,[t("div",_n,[(u(),p("svg",{viewBox:`0 0 ${n.width} ${n.height}`},[t("path",{d:l.path,fill:"transparent",stroke:"#666","stroke-width":"2"},null,8,bn)],8,gn)),t("p",yn,f(l.path),1)]),t("div",{class:ht(["flex flex-row rounded-lg text-slate-600 p-2 text-sm gap-2",n.isActive?"bg-slate-200":"bg-slate-100"])},[g(t("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=c=>n.pointString=c),class:"w-full text-slate-600 outline-none bg-transparent pl-1",onFocus:o[1]||(o[1]=c=>n.isActive=!0),onBlur:o[2]||(o[2]=c=>n.isActive=!1)},null,544),[[y,n.pointString]]),t("button",{class:"btn",onClick:o[3]||(o[3]=(...c)=>l.reset&&l.reset(...c))},"reset")],2),wn,vn])}var kn=w(fn,[["render",xn]]);const M=2400,D=M/3,$n={data(){return{s:200,th:40,clientX:M/2,clientY:D/2,width:M,height:D,vbX:M/2,vbY:D/2,px:-1,py:-1,d:-1}},computed:{distLine(){return this.px===-1||this.py===-1?"":`M ${this.vbX} ${this.vbY} T ${this.px} ${this.py}`},gridX(){return Array(parseInt(this.width/this.s)).fill().map((e,o)=>o>0?`M ${o*this.s} 0 V ${this.height}`:"").join(" ")},gridY(){return Array(parseInt(this.height/this.s)).fill().map((e,o)=>o>0?`M 0 ${o*this.s} H ${this.width}`:"").join(" ")},points(){const e=Array(parseInt(this.width/this.s)).fill().map((r,n)=>n),o=Array(parseInt(this.height/this.s)).fill().map((r,n)=>n),i=[];return e.forEach(r=>{o.forEach(n=>{const l=r*this.s+this.s/2,c=n*this.s+this.s/2;i.push({x:l,y:c})})}),i}},methods:{onMouseMove({clientX:e,clientY:o}){this.clientX=e,this.clientY=o;const{x:i,y:r}=this.getVbCoords(e,o),n=Math.floor(i/this.s),l=Math.floor(r/this.s);this.px=n*this.s+this.s/2,this.py=l*this.s+this.s/2,this.d=Math.sqrt(V(this.px-this.vbX,2)+V(this.py-this.vbY,2))},getVbCoords(e,o){const i=this.$refs.svgelem.getScreenCTM().inverse(),r=new DOMPoint(e,o),{x:n,y:l}=r.matrixTransform(i);return this.vbX=parseInt(n),this.vbY=parseInt(l),{x:this.vbX,y:this.vbY}},reset(){this.vbX=M/2,this.vbY=D/2,this.px=-1,this.py=-1,this.d=-1}}},Tn={class:"my-5 flex flex-col items-center"},Cn={class:"border-2 rounded-lg my-2 w-full"},Sn=["viewBox"],In=["x","y","height","width"],Bn=["d"],Ln=["d"],Mn=["d"],An=["cx","cy"],Dn=["x","y"];function Vn(e,o,i,r,n,l){return u(),p("div",Tn,[t("div",Cn,[(u(),p("svg",{viewBox:`0 0 ${n.width} ${n.height}`,onMousemove:o[0]||(o[0]=(...c)=>l.onMouseMove&&l.onMouseMove(...c)),onMouseleave:o[1]||(o[1]=(...c)=>l.reset&&l.reset(...c)),class:"rounded-md",ref:"svgelem"},[n.d<n.th&&n.d!==-1?(u(),p("rect",{key:0,x:n.px-n.s/2,y:n.py-n.s/2,height:n.s,width:n.s,fill:"rgba(0, 137, 255, 0.20)"},null,8,In)):$("",!0),t("path",{fill:"transparent",stroke:"#999","stroke-dasharray":"10, 10","stroke-width":"2",d:l.distLine},null,8,Bn),t("path",{fill:"transparent",stroke:"#ccc","stroke-width":"1",d:l.gridY},null,8,Ln),t("path",{fill:"transparent",stroke:"#ccc","stroke-width":"1",d:l.gridX},null,8,Mn),(u(!0),p(x,null,C(l.points,c=>(u(),p("circle",{cx:c.x,cy:c.y,r:"2",fill:"#666"},null,8,An))),256)),n.d!==-1?(u(),p("text",{key:1,x:n.vbX+40,y:n.vbY-20,fill:"#666",class:"font-mono text-4xl"}," dist: "+f(n.d.toFixed(1)),9,Dn)):$("",!0)],40,Sn))]),t("figcaption",null," When the distance from the cursor to the center of the cell is beneath the threshold of "+f(n.th)+", the cell will turn blue. ",1)])}var Nn=w($n,[["render",Vn]]),jn="/assets/jank.060396d8.gif",On="/assets/tooltip.f29f05de.gif",Pn="/assets/nojank.28ea4a4b.gif";const Gn={data(){return{path:"/refactoring_charts",title:"Refactoring Charts",author:"18alantom",date:"2022-02-08",controlsButtonText:"show controls",first:`
      I had to rewrite the charts in Frappe Books. This seemed like the only
      option. Well almost. The other option was to push improvements to the
      charting library itself. But, I wasn't in control of that library, and
      besides it's easier to just do it from scratch.
      `}},components:{SimplePath:kn,CoordinatesTransform:zo,TheDistance:Nn,LineChartContainer:pn}},Fn=t("h2",null,"Why would you refactor the charts?",-1),Xn=t("p",null," If you look at the gif below, you'll notice that the chart takes ~800ms to load (trust me). I wouldn't be surprised if you thought the chart was being rendered by an abacus. ",-1),Yn=t("img",{src:jn},null,-1),En=t("figcaption",null,[s(" Reloading the Dashboard, slowed down 0.5x. Witness the jank, in "),t("em",null,"slowmo"),s("! ")],-1),Hn=t("p",null," Whenever I come across this kind of jank in modern software running on modern hardware, I get irked, and reasonably so. There is no reason for it to be this way. ",-1),Rn=s(" Naturally, I had to do something about it. I initially thought about using something like "),Un=s("Chart.js"),Wn=s(" or maybe "),zn=s("D3"),qn=s(" even. But there were multiple reasons not to: "),Jn=t("li",null," The charting library used by Frappe Books was built in-house, so it would probably end up annoying someone. ",-1),Kn=t("li",null,"I needed a high degree of control over how the charts looked.",-1),Qn=s(" An innate quotient for hubris that causes me to think "),Zn=s("I wonder if can do it better..."),ti=s(". "),ei=s(" I had no idea what it takes to make a chart. My only experience with charting data was from being spoonfed by "),oi=s("matplotlib"),si=s(" and "),ni=s("seaborn"),ii=s(" (Python charting libraries). "),li=t("h2",null,"The Refactoring",-1),ai=s(" I initially thought of using "),ri=s("HTML Canvas"),hi=s(", but since Canvas has no DOM, it would involve writing code for object detection and what not. So I went with SVG. "),di=t("p",null,[s(" Given my lack of knowledge with how SVG worked, I thought it would take multiple days. But SVG primitives turned out to be suprisingly simple and rewriting the charts in Frappe Books took less than a day of "),t("em",null,"coding time"),s(". ")],-1),ci=t("h3",null,"The Super Simple",-1),ui=t("p",null,[s(" The actual rewriting was easier, but more involved that I thought. For instance a simple line chart would be just a single SVG "),t("code",null,"<path/>"),s(" element: ")],-1),pi=t("p",null,[s(" Of course if I rewrote the Cashflow chart in Books using a single "),t("code",null,"<path/>"),s(" element, I'd very quickly become the company idiot. ")],-1),fi=t("h3",null,"The Not So Simple",-1),mi=s(" Things start to get a bit more involved when one gets into the deets of a chart. "),_i=s("A chart has to have labels! How can a chart not have labels, how will I know what the data is?"),gi=s(" So we gotta add labels, two sets of them, for the "),bi=t("i",null,"x",-1),yi=s(" and the "),wi=t("i",null,"y",-1),vi=s(" axis: "),xi=t("p",null," Of course, once labels are added, some would argue that a line chart wouldn't be a line chart without grid and axis lines. Not the kind of people I would want to argue with, so we gotta add that in too. ",-1),ki=t("p",null,[s(" With all of that, things have to be customizable customizable right.. "),t("em",null,"Right"),s("? Right! ")],-1),$i=s("Click on "),Ti=s(" to toggle chart customization."),Ci=s(" Just adding in a few components has caused the simple line chart having just one "),Si=t("code",null,"<path/>",-1),Ii=s(" element to explode in complexity. "),Bi=s("You can "),Li=s("inspect element"),Mi=s(" to check how many elements it has now."),Ai=s(" We aren't even half way there. The people who would argue about the axis and the grids, are probably going "),Di=s("You forgot the y-grid lines, also what about the x and y axis ticks, major ticks, minor ticks, I want to control the height of the ticks, inset ticks, outset..."),Vi=s(" but at this point I have my fingers in my ears and am slowly walking away. "),Ni=t("h3",null,"Cherry on the Chart",-1),ji=t("p",null,[s(" Another thing that bothered me about the chart was how the tooltip behaved. It was a "),t("em",null,"bit"),s(" jarring. ")],-1),Oi=t("p",null," Actually this wasn't an after thought, the crassness of this UX persists beyond the initial loading time. So it at least tantamount to the previous issue if not more important. ",-1),Pi=t("img",{src:On},null,-1),Gi=t("figcaption",null,"The tooltip of no one's dreams.",-1),Fi=t("p",null,[s(" If there are two lines and I'm hovering above the lower line, the tooltip shows above the upper line with info about both the points. "),t("em",null,"What?!")],-1),Xi=t("p",null," The kind of behaviour I want is that the tooltip appears above the cursor when I'm close to a datapoint and it should only show info pertinent to that point. ",-1),Yi=s(" Now, if you're as stupid as me, you're probably thinking "),Ei=s(" that's super simple to achieve, just slap an "),Hi=t("code",null,"onhover",-1),Ri=s(" on that point and call it day! "),Ui=s(" And you'd be wrong because: "),Wi=t("ol",null,[t("li",null,[s(" The line has no points, it's a single element, so "),t("code",null,"onhover"),s(" would capture the entire line. ")]),t("li",null,[t("code",null,"onhover"),s(" works only if you're "),t("em",null,"on"),s(" the element, not near it. ")])],-1),zi=s(" But, you're probably smarter than me and thought "),qi=s("that's not gonna be simple"),Ji=s(" and you're right. This involves: "),Ki=t("ol",null,[t("li",null,[s(" Converting the cursor's DOM coordinates into SVG "),t("code",null,"viewBox"),s(" coordinates. ")]),t("li",null,"Calculating the distance to all the points."),t("li",null,"Render tooltip on the basis of the distance.")],-1),Qi=t("h4",null,"Point One - The Coordinates",-1),Zi=t("p",null," This is fairly simple once you know that you can get the inverse transformation matrix from the SVG using: ",-1),tl=s("const inv = svgElement.getScreenCTM().inverse();"),el=t("p",null,[s(" Then you can create a "),t("code",null,"DOMPoint"),s(" using viewport coordinates, transform it, and get the SVG "),t("code",null,"viewBox"),s(" coordinates from it: ")],-1),ol=s(" const {x, y} = new DOMPoint(cursorX, cursorY).matrixTransform(inv); "),sl=t("p",null,"In the window below you can see the effect of the transform.",-1),nl=N("<h4>Point Two - The Distance</h4><p> Now we need to know which point are nearest to the cursor. For which we need to calculate the distance to all the points, <em>right?</em></p><p>You may have realized that:</p><ol><li>That the points lie on a grid.</li><li>Each cell has exactly one point.</li><li>The cursor can be only in one cell at a time.</li><li>The coordinates of this cell can be obtained by division.</li></ol><p> Because of this realization, a jank inducing <code>O(n)</code> becomes a quick <code>O(1)</code>. Now we just need to calculate the distance to a single point everytime <code>mouseover</code> is triggered over the SVG element. </p><p><i> Note: by division I mean <code>Math.floor(cursorLocation / cellSize)</code></i></p><p>Here&#39;s a box to illustrate this calculation:</p>",7),il=t("h4",null,"Point Three - The Tooltip",-1),ll=s(" Okay, this is a bit anticlimactic. Frappe Books already had "),al=s("popper.js"),rl=s(" as a dependency, so I thought "),hl=s("eh, I'll just use that"),dl=s(". And so here \u{1F447} is the final line chart, tooltip and all, almost an exact replica of the one in Frappe Books! "),cl=t("p",null," And if you're wondering about the jankiness of this implementation, here's a gif: ",-1),ul=t("img",{src:Pn},null,-1),pl=t("figcaption",null," This too is slowed down 0.5x like the first gif, in fact I had to use a higher frame rate for the empty state to show. ",-1),fl=t("hr",null,null,-1),ml=t("p",null,"A few closing thoughts...",-1),_l=s(" Writing sufficiently performant code is made much easier by using "),gl=s("Vue.js"),bl=s(". CLOC of only the line chart at the time of writing is ~300. Doing this using Vanilla JS has potential to be faster (obviously) but would've been way more complicated, and much harder to do well. "),yl=s(" This post was just about the line chart, the donut chart was a "),wl=t("em",null,"whole other thing",-1),vl=s(", not as complex, but more mathematically involved. Due to the absolutely unintuitive nature of drawing arcs in SVG, using "),xl=t("code",null,"<path/>",-1),kl=s(", I had to breakout some trigo to solve this one. No, I won't be writing a post on that, you can "),$l=s("look at the code"),Tl=s(" if you want though. \u270C\uFE0F ");function Cl(e,o,i,r,n,l){const c=_("post-head"),a=_("l"),m=_("di"),k=_("SimplePath"),v=_("LineChartContainer"),B=_("codeblock"),z=_("CoordinatesTransform"),q=_("TheDistance");return u(),p(x,null,[h(c,{date:n.date,author:n.author},{default:d(()=>[s(f(n.title),1)]),_:1},8,["date","author"]),t("p",null,f(n.first),1),Fn,Xn,Yn,En,Hn,t("p",null,[Rn,h(a,{href:"https://github.com/chartjs/Chart.js"},{default:d(()=>[Un]),_:1}),Wn,h(a,{href:"https://github.com/d3/d3"},{default:d(()=>[zn]),_:1}),qn]),t("ol",null,[Jn,Kn,t("li",null,[Qn,h(m,null,{default:d(()=>[Zn]),_:1}),ti])]),t("p",null,[ei,h(a,{href:"https://github.com/matplotlib/matplotlib"},{default:d(()=>[oi]),_:1}),si,h(a,{href:"https://github.com/mwaskom/seaborn"},{default:d(()=>[ni]),_:1}),ii]),li,t("p",null,[ai,h(a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API"},{default:d(()=>[ri]),_:1}),hi]),di,ci,ui,h(k),pi,fi,t("p",null,[mi,h(m,null,{default:d(()=>[_i]),_:1}),gi,bi,yi,wi,vi]),xi,ki,h(v,{onShowingToggle:o[0]||(o[0]=J=>n.controlsButtonText=J)},{default:d(()=>[$i,t("i",null,f(n.controlsButtonText),1),Ti]),_:1}),t("p",null,[Ci,Si,Ii,t("em",null,[Bi,h(a,{href:"https://developer.chrome.com/docs/devtools/open/"},{default:d(()=>[Li]),_:1}),Mi])]),t("p",null,[Ai,h(m,null,{default:d(()=>[Di]),_:1}),Vi]),Ni,ji,Oi,Pi,Gi,Fi,Xi,t("p",null,[Yi,h(m,null,{default:d(()=>[Ei,Hi,Ri]),_:1}),Ui]),Wi,t("p",null,[zi,h(m,null,{default:d(()=>[qi]),_:1}),Ji]),Ki,Qi,Zi,h(B,null,{default:d(()=>[tl]),_:1}),el,h(B,null,{default:d(()=>[ol]),_:1}),sl,h(z),nl,h(q),il,t("p",null,[ll,h(a,{href:"https://popper.js.org/docs/v2/virtual-elements/"},{default:d(()=>[al]),_:1}),rl,h(m,null,{default:d(()=>[hl]),_:1}),dl]),h(v,{showTooltip:!0,showControls:!1,axisOn:!1}),cl,ul,pl,fl,ml,t("p",null,[_l,h(a,{href:"https://github.com/vuejs/vue"},{default:d(()=>[gl]),_:1}),bl]),t("p",null,[yl,wl,vl,xl,kl,h(a,{href:"https://github.com/frappe/books/pull/311/files#diff-797bee25d2e6496e019d8a6d3841f326475f41375f14226b749c1e165d88fa80R116"},{default:d(()=>[$l]),_:1}),Tl])],64)}var Sl=w(Gn,[["render",Cl]]);const Il={data(){return{path:"/why",title:"Why does this blog exist?",author:"18alantom",date:"2022-01-31",first:`
      A few days ago, I refactored all the charting code in Frappe Books.
      This is something I thought would be difficult and would take me a week or
      so. But I surprised myself by managing to do it in under 24 hours, divided
      into 3 bursts.
      `}}},Bl=t("p",null," I felt pretty cool after doing that and wanted to share this with someone. But no one whom I thought would find it cool came to mind. ",-1),Ll=t("p",null," I did share it extemporarily with another dev from the company. This dev, on looking at the code asked me whether I copied it from somewhere (this I took both as a compliment and an insult). ",-1),Ml=t("p",null," Nevertheless, not having an obvious avenue to share one's wins leads to a certain flavor of bleakness that can be quite the demotivator. ",-1),Al=t("p",null," The reason for this is, at the time of writing, I'm the only dev in the company who works on Frappe Books. Suffice to say there is little to no common ground between me and the other devs regarding work (afaik everyone else works\u2014directly or indirectly\u2014on the company flagship ERPNext). ",-1),Dl=t("p",null," So, to allay this lonerism, I decided that I'd write about the wins and losses, and other learnings that I come across on this journey to making Frappe Books a great product. ",-1);function Vl(e,o,i,r,n,l){const c=_("post-head");return u(),p(x,null,[h(c,{date:n.date,author:n.author},{default:d(()=>[s(f(n.title),1)]),_:1},8,["date","author"]),t("p",null,f(n.first),1),Bl,Ll,Ml,Al,Dl],64)}var Nl=w(Il,[["render",Vl]]),U=[Nl,Sl,yo,ue].map(e=>Object.assign(e.data(),{component:e})).sort(({date:e},{date:o})=>new Date(o)-new Date(e));const jl={computed:{posts(){return U.map(({path:e,title:o,author:i,date:r,first:n})=>({path:e,title:o,author:i,date:H(r),first:Et(n)}))}}},Ol=t("h6",{class:"font-bold text-4xl mb-10 text-gray-400"},[s(" A simple blog that documents the development of "),t("span",{class:"text-blue-frappe"},"Frappe"),s(f(" ")+" "),t("span",{class:"text-gray-books"},"Books"),s(". ")],-1),Pl={class:"text-2xl font-semibold mb-2 text-slate-700"},Gl={class:"text-sm mb-2"},Fl={class:"font-semibold"},Xl=t("span",null," \xB7 ",-1),Yl={class:"font-light"},El={class:"font-light"};function Hl(e,o,i,r,n,l){const c=_("router-link");return u(),p(x,null,[Ol,t("section",null,[(u(!0),p(x,null,C(l.posts,a=>(u(),E(c,{to:a.path,class:"mb-10 block no-a"},{default:d(()=>[t("div",null,[t("h2",Pl,f(a.title),1),t("p",Gl,[t("span",Fl,f(a.author),1),Xl,t("span",Yl,f(a.date),1)]),t("p",El,f(a.first),1)])]),_:2},1032,["to"]))),256))])],64)}var Rl=w(jl,[["render",Hl]]);const W=U.map(({component:e,path:o})=>({component:e,path:o}));W.push({path:"/",component:Rl});const Ul=dt(),Wl=ct({routes:W,history:Ul}),I=ut(kt);I.component("post-head",Kt);I.component("post-foot",Xt);I.component("di",At);I.component("l",jt);I.component("codeblock",It);I.use(Wl).mount("#app");
